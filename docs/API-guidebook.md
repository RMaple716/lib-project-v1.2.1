# API手册
---
>#### 提醒:
> VSCode中查看markdown文件的预览的快捷键：`ctrl + shift + v`
  VSCode中导出markdown文件为pdf的快捷键：`ctrl + shift + p`，然后输入`Markdown PDF`，选择`Markdown PDF: Export`，然后选择导出路径。
  VSCode中在预览中查找特定词汇的快捷键：`ctrl + f`


## 1. 用户登录(auth.js)
- **接口地址**：`/api/auth/login`
- **请求方式**：`GET`
- **请求参数**：
  - `body`：
    - `account`：用户账号
    - `password`：用户密码
    - `utype`：用户角色 ( **记得用户分级** )
- **返回值**：
  - `status`：400（用户不存在或密码错误），200（登录成功）或500（服务器错误）
  - `code`：2001（登录成功）、4002（用户不存在）、4003（密码错误）
  - `message`：相应的toast提示信息
  - `usertype`：登录用户的角色
  - `req.session._uid`：用户的uid（仅登录成功时返回）


## 2. 用户注册(auth.js)
- **接口地址**：`/api/auth/register`
- **请求方式**：`POST`
- **请求参数**：
  - `body`：
    - `account`：用户注册账号
    - `name`：用户注册名
    - `email`：用户邮箱
    - `usertype`：用户类型
    - `password`：用户注册密码
- **返回值**：
  - `status`：400（密码复杂度不够或用户已存在）或200（注册成功）或500（服务器错误）
  - `code`：4001（用户已存在）、4004（密码复杂度不够）
  - `message`：相应的提示信息
  - `usertype`：角色注册角色（仅注册成功时返回）


## 3. 获取未筛选图书信息(page.js)
- **接口地址**：`/api/page/books`
- **请求方式**：`GET`
- **请求参数**：无
- **返回值**：
  - `status`：400（没有找到图书）或500（服务器错误）或200（成功找到图书）
  - `message`：相应的提示信息
  - `data`：booklist（按图书ID升序排序的存放所有书籍信息的数组，仅成功找到图书时返回）


## 4. 搜索指定图书信息（page.js）
- **接口地址**：`/api/page/search`
- **请求方式**：`GET`
- **请求参数**：
  - `req.query.query`：特定字符串，动态输入
- **返回值**：
  - `status`：400（未找到图书）或500（服务器错误）或200（找到特定图书）
  - `code`：4001（未找到图书）
  - `message`：相应的提示信息
  - `data`：booklist（包含特定书籍信息的数组，仅找到特定图书时返回）


## 5. 查询读者借阅数量
- **接口地址**：`/api/books/borrow/count`
- **请求方式**：`GET`
- **请求参数**：
  - `q`：动态输入的读者uid
- **返回值**：
  - `status`：400（未找到读者信息）或500（服务器错误）或200（成功找到读者借阅数量）
  - `message`：相应的提示信息
  - `_name`: 读者的姓名（仅成功找到时返回）
  - `_lend_num`：读者的借阅数量（仅成功找到时返回）


## 6. 读者借阅图书
- **接口地址**：`/api/page/books/borrow`
- **请求方式**：`POST`
- **请求参数**：
  - `body`：
    - `_bid`：图书ID
    - `_uid`：读者ID
- **返回值**：
  - `status`：400（图书未找到或图书已被借完）或500（服务器错误）或200（借书成功）
  - `message`：相应的提示信息
  - `data`：borrow_history（借书成功时的借书记录）


## 7. 读取图书种类信息
- **接口地址**：`/api/page/categories`
- **请求方式**：`GET`
- **请求参数**：无
- **返回值**：
  - `status`：400（未找到分类信息）或500（服务器错误）或200（成功找到分类信息）
  - `message`：相应的提示信息
  - `data`：catlist（存放图书分类数组，仅成功找到时返回）


## 8. 管理员获取读者信息
- **接口地址**：`/api/page/readers`
- **请求方式**：`GET`
- **请求参数**：无
- **返回值**：
  - `status`：400（未找到读者信息）或500（服务器错误）或200（成功获取读者列表）
  - `message`：相应的提示信息
  - `readerlist`：读者列表（仅成功获取时返回）


## 9. 获取公告信息
- **接口地址**：`/api/page/announcement`
- **请求方式**：`GET`
- **请求参数**：无
- **返回值**：
  - `status`：400（未找到公告信息）或500（服务器错误）或200（成功获取公告列表）
  - `message`：相应的提示信息
  - `data`：公告列表（仅成功获取时返回）


## 10. 新增图书数据
- **接口地址**：`/api/page/books/add`
- **请求方式**：`POST`
- **请求参数**：
  - `body`：
    - `_book_name`：书名
    - `_isbn`：ISBN码
    - `_num`：馆藏数量
    - `_author`：作者
    - `_press`：出版社
    - `_tid`：图书类型ID
- **返回值**：
  - `status`：400（图书数量不符合规范或图书之前已经添加过）或200（图书添加成功或图书数量更新成功）或500（服务器错误）
  - `message`：相应的提示信息


## 11. 新增读者数据
- **接口地址**：`/api/page/readers/add`
- **请求方式**：`POST`
- **请求参数**：
  - `body`：
    - `_account`：读者账号
    - `_name`：读者姓名
    - `_password`：读者密码
    - `_role`：读者角色
    - `_email`：读者邮箱
- **返回值**：
  - `status`：400（读者密码强度不够或读者已存在）或200（添加读者成功）
  - `code`：4004（密码强度不够）
  - `message`：相应的提示信息
  - `data`：r_add(读者信息，仅成功添加时返回)


## 12. 新增公告数据
- **接口地址**：`/api/page/announcement/add`
- **请求方式**：`POST`
- **请求参数**：
  - `body`：
    - `_title`：公告标题
    - `_content`：公告内容
- **返回值**：
  - `status`：400（标题或内容为空）或200（添加公告成功）或500（服务器错误）
  - `message`：相应的提示信息
  - `data`：res_insert(添加的公告信息，仅成功添加时返回)


## 13. 编辑图书数据
- **接口地址**：`/api/page/books/edit`
- **请求方式**：`PUT`
- **请求参数**：
  - `body`：
    - `_book_name`：书名
    - `_isbn`：ISBN码
    - `_num`：馆藏数量
    - `_author`：作者
    - `_press`：出版社
    - `_tid`：图书类型ID
    - `_bid`：图书ID
- **返回值**：
  - `status`：400（未找到书籍信息）或200（成功编辑图书信息）或500（服务器错误）
  - `message`：相应的提示信息
  - `data`：res_update[0]（成功编辑图书信息时的图书信息）


## 14. 编辑读者数据
- **接口地址**：`/api/page/readers/edit`
- **请求方式**：`PUT`
- **请求参数**：
  - `body`：
    - `_account`：读者账号
    - `_name`：读者姓名
    - `_email`：读者邮箱
    - `_uid`：读者ID
- **返回值**：
  - `status`：400（读者信息不存在）或200（读者信息更新成功）或500（服务器错误）
  - `message`：相应的提示信息
  - `data`：res_update[0]（成功编辑读者信息时的读者信息）


## 15. 编辑公告数据
- **接口地址**：`/api/page/announcement/edit`
- **请求方式**：`PUT`
- **请求参数**：
  - `body`：
    - `_title`：公告标题
    - `_content`：公告内容
    - `_aid`：公告ID
- **返回值**：
  - `status`：400（标题和内容为空或_aid为空）或200（成功编辑公告）或500（服务器错误）
  - `message`：相应的提示信息
  - `data`：res_insert[0]（成功编辑公告时的公告信息）


## 16. 删除图书数据
- **接口地址**：`/api/page/books/delete`
- **请求方式**：`DELETE`
- **请求参数**：
  - `body`：
    - `_bid`：图书ID
- **返回值**：
  - `status`：400（图书有未归还记录，无法删除或图书信息未找到）或200（成功删除图书信息）或500（服务器错误）
  - `message`：相应的提示信息


## 17. 删除读者数据
- **接口地址**：`/api/page/readers/delete`
- **请求方式**：`DELETE`
- **请求参数**：
  - `body`：
    - `_uid`:读者ID
- **返回值**：
  - `status`：400（读者信息丢失）或200（读者信息成功删除）或500（服务器错误）
  - `message`：相应的提示信息
  - `data`：res_delete[0]（成功删除读者信息时的读者信息）


## 18. 删除公告数据
- **接口地址**：`/api/page/announcement/delete`
- **请求方式**：`DELETE`
- **请求参数**：
  - `body`：
    - `_aid`：公告ID
- **返回值**：
  - `status`：400（公告ID未输入或对应公告未找到）或200（成功删除公告）或500（服务器错误）
  - `message`：相应的提示信息
  - `data`：res_delete[0]（成功删除公告时的公告信息）


## 19. 读者归还图书
- **接口地址**：`/api/page/books/return`
- **请求方式**：`PUT`
- **请求参数**：
  - `body`：
    - `_hid`：借阅书籍数据ID
- **返回值**：
  - `status`：400（未找到公告信息或还书超期）或500（服务器错误）或200（成功还书）
  - `code`：1（未找到书籍）、2（还书超期）
  - `message`：相应的提示信息
  - `data`：suc_return（成功还书时的借书记录）


## 20. 管理员获取读者借阅信息 
- **接口地址**：`/api/page/history`
- **请求方式**：`GET`
- **请求参数**：无
- **返回值**：
  - `status`：400（未找到历史记录）或200（成功找到所有历史记录）或500（服务器错误）
  - `data`：historylist(读者借阅信息列表)
  - `message`：相应的提示信息


## 21. 读者获取自己的借阅信息
- **接口地址**：`/api/page/r_history`
- **请求方式**：`GET`
- **请求参数**：无
- **返回值**：
  - `status`：400（未找到历史记录）或200（成功找到所有历史记录）或500（服务器错误）
  - `message`：相应的提示信息
  - `data`：ownlist (指定读者借阅信息列表)


## 22. 图书续借
- **接口地址**：`/api/page/books/borrow/delay`
- **请求方式**：`PUT`
- **请求参数**：
  - `body`：
    - `_hid`：借阅书籍数据ID
- **返回值**：
  - `status`：400（图书信息未找到）或200（图书续借成功）或500（服务器错误）
  - `message`：相应的提示信息
  - `data`：res_delay[0]（更改后的那条借阅数据，仅续借成功时返回）


## 23. 图书排名显示
- **接口地址**：`/api/page/books/rank`
- **请求方式**：`GET`
- **请求参数**：无
- **返回值**：
  - `status`：400（获取图书排名数据失败）或200（成功获取图书排名数据）或500（服务器错误）
  - `message`：相应的提示信息
  - `data`：res_rank[0]（按借阅次数从多到少排列的图书列表，仅成功获取时返回）


## 24. 读者排名显示
- **接口地址**：`/api/page/readers/rank`
- **请求方式**：`GET`
- **请求参数**：无
- **返回值**：
  - `status`：400（未得到读者排名信息）或200（得到读者排名信息）或500（服务器错误）
  - `message`：相应的提示信息
  - `data`：res_rank[0]（读者排名信息，仅成功获取时返回）


## 25. 读者端显示公告
- **接口地址**：`/api/page/readers/announcement`
- **请求方式**：`GET`
- **请求参数**：无
- **返回值**：
  - `status`：400（无法获取公告）或200（成功获取公告）或500（服务器错误）
  - `message`：相应的提示信息
  - `data`：res_find(最新的一条公告)


## 26. 获取当前登录用户信息
- **接口地址**：`/api/page/currentuser`
- **请求方式**：`GET`
- **请求参数**：无
- **返回值**：
  - `status`：200（成功获取登陆者信息）或400（未登录）或500（服务器错误）
  - `message`：相应的提示信息
  - `_uid`：登录用户的ID


## 27. 新增分类信息
- **接口地址**：`/api/page/category/add`
- **请求方式**：`POST`
- **请求参数**：
  - `body`：
    - `_tid`：分类ID
    - `_type_name`：分类名称
- **返回值**：
  - `status`：400（输入参数不规范或新增分类已存在）或200（添加分类成功）或500（服务器错误）
  - `message`：相应的提示信息
  - `data`：(添加的分类信息)


## 28. 编辑分类信息
- **接口地址**：`/api/page/category/edit`
- **请求方式**：`PUT`
- **请求参数**：
  - `body`：
    - `_tid`：分类ID
    - `_type_name`：分类名称
- **返回值**：
  - `status`：400（ID为空或分类不存在或分类名已存在）或200（修改成功）或500（服务器错误）
  - `message`：相应的提示信息
  - `data`：(修改后的分类信息)


## 29. 删除分类信息
- **接口地址**：`/api/page/category/delete`
- **请求方式**：`DELETE`
- **请求参数**：
  - `body`：
    - `_tid`：分类ID
- **返回值**：
  - `status`：400（ID为空或删除分类成功或分类不存在或该分类下存在图书）或500（服务器错误）
  - `message`：相应的提示信息
  - `data`：删除的分类信息

## 30. 生成验证码
- **接口地址**：`/api/page/captcha`
- **请求方式**：`GET`
- **请求参数**：无
- **返回值**：
  - `status`：200（成功生成验证码）或500（服务器错误）
  - `message`：相应的提示信息
  - `data`：验证码图片的base64编码

## 31. 修改并重置密码
- **接口地址**：`/api/page/reset-password`
- **请求方式**：`PUT`
- **请求参数**：
  - `body`：
    - `_uid`：用户ID
    - `_password`：新密码
    - `_captcha`：验证码
- **返回值**：
  - `status`：400（输入参数不规范或验证码错误）或200（修改密码成功）或500（服务器错误）
  （修改密码成功后会尝试发送邮件，发送邮件成功后会提示成功发送）
  - `code`：4005（验证码错误）或4004（密码复杂度过低）或4002（用户不存在）
  - `message`：相应的提示信息
  - `data`：修改后的用户信息

